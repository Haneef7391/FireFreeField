<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Green Energy Submissions</title>
  <link rel="stylesheet" href="green-success.css">
</head>
<body>
  <div class="wrapper">
    <div class="top-buttons">
      <button class="btn btn-home" onclick="window.location.href='index.html'">
        ‚Üê Back to Home
      </button>
      <button class="btn btn-add" onclick="window.location.href='green-energy.html'">
        + New Green Submission
      </button>
      <button class="btn btn-clear" onclick="clearAll()">
        Clear All Submissions
      </button>
    </div>
    

    <!-- Shown only when no data -->
    <div id="emptyState" class="empty" style="display:none;">
      No Green Energy submissions found yet. Please submit the Green Energy form first.
    </div>

    <div id="cards"></div>
  </div>

  <script>
    function clearAll() {
      if (!confirm("Are you sure you want to delete all saved Green Energy submissions on this device?")) return;
      localStorage.removeItem("greenSubmissions");
      location.reload();
    }

    const raw = localStorage.getItem("greenSubmissions");
    const container = document.getElementById("cards");
    const emptyState = document.getElementById("emptyState");

    if (!raw) {
      emptyState.style.display = "block";
    } else {
      let list;
      try {
        list = JSON.parse(raw) || [];
      } catch (e) {
        list = [];
      }

      if (!list.length) {
        emptyState.style.display = "block";
      } else {
        emptyState.style.display = "none";

        // Latest first
        list.sort((a, b) => {
          const ta = a.createdAt ? new Date(a.createdAt).getTime() : 0;
          const tb = b.createdAt ? new Date(b.createdAt).getTime() : 0;
          return tb - ta;
        });

        list.forEach((s) => {
          const created = s.createdAt
            ? new Date(s.createdAt).toLocaleString()
            : "Unknown time";

          container.innerHTML += `
            <div class="card">
              <div class="header">
                <div>
                  <div class="title">${s.company || "Unknown Company"}</div>
                  <div class="timestamp">Submitted: ${created}</div>
                </div>
                <div class="tag">${s.wasteType || "Crop waste"}</div>
              </div>

              <div class="section">
                <div class="section-title">üåæ Crop & Company Info</div>
                ${row("Company", s.company)}
                ${row("Type of Crop Waste", s.wasteType)}
                ${row("Quantity", s.quantity)}
              </div>

              <div class="section">
                <div class="section-title">üí∞ Payment & Receiving</div>
                ${row("Payment Mode", s.paymentMode)}
                ${row("Mode of Receiving Money", s.benefitMode)}
              </div>

              <div class="section">
                <div class="section-title">üèõ Govt Carbon Trade</div>
                ${row("Carbon Trade Range (Coal Equivalent)", s.govtTrading)}
              </div>

              <div class="section">
                <div class="section-title">üîí Upload & Security</div>
                ${row("Uploaded Image (file name)", s.uploadedImage)}
                ${passwordRow("Password", s.password)}
                <div class="note">
                  The actual image is not uploaded to any server.
                </div>
              </div>
            </div>
          `;
        });
      }
    }

    function row(label, value) {
      const v = value && String(value).trim()
        ? value
        : "<i style='opacity:0.6'>Not provided</i>";

      return `
        <div class="row">
          <span>${label}</span>
          <strong>${v}</strong>
        </div>
      `;
    }

    function passwordRow(label, value) {
      let v;
      if (value && String(value).trim()) {
        v = "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢";
      } else {
        v = "<i style='opacity:0.6'>Not provided</i>";
      }

      return `
        <div class="row">
          <span>${label}</span>
          <strong>${v}</strong>
        </div>
      `;
    }
  </script>
</body>
</html>
