<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Farmer Submissions - Green Energy</title>
  <link rel="stylesheet" href="success.css">
</head>
<body>
  <div class="wrapper">
    <div class="top-buttons">
      <button class="btn btn-home" onclick="window.location.href='index.html'">
        ‚Üê Back to Home
      </button>
      <button class="btn btn-add" onclick="window.location.href='Dont-waste.html'">
        + New Green Submission
      </button>
      <button class="btn btn-clear" onclick="clearAll()">
        Clear All Submissions
      </button>
    </div>

    <!-- Hidden by default, only shown when there is no data -->
    <div id="emptyState" class="empty" style="display:none;">
      No submissions found yet. Please submit the form first.
    </div>

    <div id="cards"></div>
  </div>
  <script>
    function clearAll() {
      if (!confirm("Are you sure you want to delete all saved submissions on this device?")) return;
      localStorage.removeItem("submissions");
      location.reload();
    }

    const raw = localStorage.getItem("submissions");
    const container = document.getElementById("cards");
    const emptyState = document.getElementById("emptyState");

    if (!raw) {
      // Nothing in localStorage at all
      emptyState.style.display = "block";
    } else {
      let list;
      try {
        list = JSON.parse(raw) || [];
      } catch (e) {
        list = [];
      }

      if (!list.length) {
        // Array exists but is empty
        emptyState.style.display = "block";
      } else {
        // We have data ‚Üí hide empty state
        emptyState.style.display = "none";

        // Latest first
        list.sort((a, b) => {
          const ta = a.createdAt ? new Date(a.createdAt).getTime() : 0;
          const tb = b.createdAt ? new Date(b.createdAt).getTime() : 0;
          return tb - ta;
        });

        list.forEach((s) => {
          const created = s.createdAt
            ? new Date(s.createdAt).toLocaleString()
            : "Unknown time";

          container.innerHTML += `
            <div class="card">
              <div class="header">
                <div>
                  <div class="title">${s.name || "Unnamed Farmer"}</div>
                  <div class="timestamp">Submitted: ${created}</div>
                </div>
                <div class="tag">${s.cropWaste || "Crop not set"}</div>
              </div>

              <div class="section">
                <div class="section-title">üë§ Farmer Info</div>
                ${row("Full Name", s.name)}
                ${row("Gender", s.gender)}
                ${row("Mobile Number", s.mobile)}
                ${row("State", s.state)}
                ${row("Mandal", s.mandal)}
                ${row("Preferred Language", s.language)}
              </div>

              <div class="section">
                <div class="section-title">üåæ Crop & Waste</div>
                ${row("Crop Waste", s.cropWaste)}
                ${row("Quantity", s.quantity)}
              </div>

              <div class="section">
                <div class="section-title">üí∞ Payment & Benefits</div>
                ${row("Payment Mode", s.payment)}
                ${row("Benefit Type", s.benefit)}
                ${row("Seed Type", s.seeds)}
                ${row("Tool Type", s.tools)}
              </div>
            </div>
          `;
        });
      }
    }

    function row(label, value) {
      const v = value && String(value).trim()
        ? value
        : "<i style='opacity:0.6'>Not provided</i>";

      return `
        <div class="row">
          <span>${label}</span>
          <strong>${v}</strong>
        </div>
      `;
    }
  </script>
</body>
</html>
